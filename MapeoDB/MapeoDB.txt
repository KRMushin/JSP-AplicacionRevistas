create schema app_revistas;
use app_revistas;

CREATE TABLE fotos_usuario (
    id_foto BIGINT AUTO_INCREMENT PRIMARY KEY, 
    foto_usuario VARCHAR(15), 
    foto BLOB
);
CREATE TABLE usuarios (
    nombre_usuario VARCHAR(15) NOT NULL UNIQUE PRIMARY KEY,
    password_usuario VARCHAR(200) NOT NULL,
    rol_usuario ENUM('COMPRADOR', 'SUSCRIPTOR', 'EDITOR', 'ADMINISTRADOR') NOT NULL,
    nombre_pila VARCHAR(100) NOT NULL,
    descripcion_usuario TEXT,
    id_foto BIGINT,
    FOREIGN KEY (id_foto) REFERENCES fotos_usuario(id_foto) ON DELETE SET NULL
);

CREATE TABLE preferencias_usuario (    
	id_preferencia BIGINT AUTO_INCREMENT PRIMARY KEY,      
	nombre_usuario VARCHAR(15),
	tipo_preferencia ENUM('HOBBIE', 'GUSTO', 'TEMA_PREFERENCIA') NOT NULL,      	 
	valor_preferencia VARCHAR(20) NOT NULL,      
	FOREIGN KEY (nombre_usuario) REFERENCES usuarios(nombre_usuario)  
);

CREATE TABLE carteras_digitales (
    usuario_representante VARCHAR(15) PRIMARY KEY, 
    saldo_disponible DECIMAL(10,2) NOT NULL DEFAULT 0.0,
    FOREIGN KEY (usuario_representante) REFERENCES usuarios(nombre_usuario)  
);







/*					PARTES ELIMINIADAS DE HTML 	FOTOS */

                <label for="foto">Sube tu foto para tu perfil (PNG, JPG):</label>
                <input type="file" id="foto" name="foto" accept=".png, .jpg, .jpeg">
                <br><br>
                
                        if (req.getPart("foto") != null && req.getPart("foto").getSize() > 0) { 
            InputStream fot = req.getPart("foto").getInputStream();
            nuevoUsuario.setFoto(fot);
        }










import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

public class AuthService {
    private static final BCryptPasswordEncoder passwordEncoder = new BCryptPasswordEncoder();

    /**
     * Verifica si la contraseña ingresada coincide con la contraseña almacenada.
     *
     * @param plainPassword  La contraseña ingresada por el usuario.
     * @param storedPassword La contraseña encriptada almacenada en la base de datos.
     * @return true si las contraseñas coinciden, false de lo contrario.
     */
    public static boolean verifyPassword(String plainPassword, String storedPassword) {
        return passwordEncoder.matches(plainPassword, storedPassword);
    }
}

import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

public class PasswordUtil {
    private static final BCryptPasswordEncoder passwordEncoder = new BCryptPasswordEncoder();

    /**
     * Encripta la contraseña del usuario utilizando BCrypt.
     *
     * @param plainPassword La contraseña ingresada por el usuario.
     * @return La contraseña encriptada.
     */
    public static String encryptPassword(String plainPassword) {
        return passwordEncoder.encode(plainPassword);
    }
}

